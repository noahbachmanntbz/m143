# Tagesdokumentation ‚Äî 02.09.2025

Kurzfassung: Erweiterung der Backup-L√∂sung um RDS MySQL-Datenbanken. RDS-Instanz erstellt, Testdatenbank ‚Äûschool" mit Sch√ºlerdaten angelegt, Backup-Skript f√ºr MySQL-Dumps implementiert und in Cronjob integriert. Automatische Sicherung der Datenbanken nach S3 erfolgreich getestet.

---

## ‚úÖ Erledigte Arbeiten

- RDS MySQL-Instanz erstellt und konfiguriert
- Verbindung von EC2 zu RDS hergestellt und getestet
- Testdatenbank ‚Äûschool" mit Beispieldaten angelegt
- Backup-Skript f√ºr RDS-Dumps erstellt (`rds_backup.sh`)
- Cronjob f√ºr t√§gliche Datenbank-Backups eingerichtet
- Uploads nach S3 validiert

---

## üóÑÔ∏è Erstellung der RDS MySQL Instanz
```bash
aws rds create-db-instance   --region us-east-1   --db-instance-identifier mylabdb   --engine mysql   --engine-version 8.0.43   --db-instance-class db.t3.micro   --allocated-storage 20   --master-username admin   --master-user-password 'AdminNeu123!'   --vpc-security-group-ids sg-04a9ab39c8914b14c   --db-subnet-group-name lab-default-subnets   --no-publicly-accessible   --backup-retention-period 7   --no-deletion-protection
```

Endpoint abrufen:
```bash
aws rds describe-db-instances   --region us-east-1   --db-instance-identifier mylabdb   --query 'DBInstances[0].Endpoint.Address'   --output text
```

---

## üîó Verbindung von EC2 zu RDS
```bash
mysql -h mylabdb.cvey2eeg2a9v.us-east-1.rds.amazonaws.com -u admin -p
```
Passwort: **AdminNeu123!**

---

## üìö Testdatenbank erstellen
```sql
CREATE DATABASE school;
USE school;

CREATE TABLE students (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50),
    age INT,
    grade VARCHAR(5)
);

INSERT INTO students (name, age, grade) VALUES
('Alice', 15, 'A'),
('Bob', 16, 'B'),
('Charlie', 17, 'C'),
('David', 16, 'B'),
('Eva', 15, 'A');
```

---

## üíæ Backup-Skript f√ºr RDS
Datei: `/opt/backup/rds_backup.sh`

```bash
#!/usr/bin/env bash
set -euo pipefail
source /opt/backup/backup.env

TS=$(date -u +%Y%m%dT%H%M%SZ)
LOG=/var/backups/logs/db-$TS.log
exec > >(tee -a "$LOG") 2>&1

DUMP_DIR=/var/backups/tmp
mkdir -p "$DUMP_DIR"
OUT="$DUMP_DIR/${DB_NAME}-${TS}.sql.gz"

echo "[*] DB backup start $TS"
echo "[*] Host=$DB_HOST  DB=$DB_NAME  Region=$AWS_REGION"

mysqldump   --host="$DB_HOST"   --user="$DB_USER"   --password="$DB_PASS"   --databases "$DB_NAME"   --single-transaction   --routines --triggers | gzip -9 > "$OUT"

aws s3 cp "$OUT" "s3://$S3_BUCKET/backups/db/$DB_NAME/$(basename "$OUT")" --region "$AWS_REGION"

rm -f "$OUT"
echo "[+] DB backup done $TS"
```

Skript ausf√ºhrbar machen:
```bash
sudo chmod +x /opt/backup/rds_backup.sh
```

---

## ‚è∞ Cronjob-Setup
```cron
0 3 * * * /opt/backup/rds_backup.sh
```

Kontrolle:
```bash
crontab -l
```

---

## ‚úîÔ∏è √úberpr√ºfung in S3

```bash
aws s3 ls s3://backup-raw-bachmann-pe24c/backups/db/school/ --region us-east-1
```
‚Üí Dumps liegen im Bucket, versioniert und mit Lifecycle-Regeln abgesichert.

---

## üßæ Notizen / Referenzen

- RDS-Instanz: `mylabdb`
- Endpoint: `mylabdb.cvey2eeg2a9v.us-east-1.rds.amazonaws.com`
- Datenbank: `school`
- Backup-Skript: `/opt/backup/rds_backup.sh`
- S3-Pfad: `s3://backup-raw-bachmann-pe24c/backups/db/school/`
- Cronjob: t√§glich um 03:00 Uhr  