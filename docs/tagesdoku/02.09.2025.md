# üìë Tagesdokumentation ‚Äì RDS & SQL-Backups  
**Datum:** 02.09.2025  

---

## √úbersicht
Am 02.09.2025 wurde die bestehende Backup-L√∂sung erweitert:  
Neben den Datei-Backups von EC2 werden jetzt auch **MySQL-Datenbanken (RDS)** automatisch nach **AWS S3** gesichert.  

---

## 1. Erstellung der RDS MySQL Instanz
```bash
aws rds create-db-instance   --region us-east-1   --db-instance-identifier mylabdb   --engine mysql   --engine-version 8.0.43   --db-instance-class db.t3.micro   --allocated-storage 20   --master-username admin   --master-user-password 'AdminNeu123!'   --vpc-security-group-ids sg-04a9ab39c8914b14c   --db-subnet-group-name lab-default-subnets   --no-publicly-accessible   --backup-retention-period 7   --no-deletion-protection
```

Endpoint abrufen:
```bash
aws rds describe-db-instances   --region us-east-1   --db-instance-identifier mylabdb   --query 'DBInstances[0].Endpoint.Address'   --output text
```

---

## 2. Verbindung von EC2 zu RDS
```bash
mysql -h mylabdb.cvey2eeg2a9v.us-east-1.rds.amazonaws.com -u admin -p
```
Passwort: **AdminNeu123!**

---

## 3. Testdatenbank erstellen
```sql
CREATE DATABASE school;
USE school;

CREATE TABLE students (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50),
    age INT,
    grade VARCHAR(5)
);

INSERT INTO students (name, age, grade) VALUES
('Alice', 15, 'A'),
('Bob', 16, 'B'),
('Charlie', 17, 'C'),
('David', 16, 'B'),
('Eva', 15, 'A');
```

---

## 4. Backup-Skript f√ºr RDS
Datei: `/opt/backup/rds_backup.sh`

```bash
#!/usr/bin/env bash
set -euo pipefail
source /opt/backup/backup.env

TS=$(date -u +%Y%m%dT%H%M%SZ)
LOG=/var/backups/logs/db-$TS.log
exec > >(tee -a "$LOG") 2>&1

DUMP_DIR=/var/backups/tmp
mkdir -p "$DUMP_DIR"
OUT="$DUMP_DIR/${DB_NAME}-${TS}.sql.gz"

echo "[*] DB backup start $TS"
echo "[*] Host=$DB_HOST  DB=$DB_NAME  Region=$AWS_REGION"

mysqldump   --host="$DB_HOST"   --user="$DB_USER"   --password="$DB_PASS"   --databases "$DB_NAME"   --single-transaction   --routines --triggers | gzip -9 > "$OUT"

aws s3 cp "$OUT" "s3://$S3_BUCKET/backups/db/$DB_NAME/$(basename "$OUT")" --region "$AWS_REGION"

rm -f "$OUT"
echo "[+] DB backup done $TS"
```

Skript ausf√ºhrbar machen:
```bash
sudo chmod +x /opt/backup/rds_backup.sh
```

---

## 5. Cronjob-Setup
```cron
0 3 * * * /opt/backup/rds_backup.sh
```

Kontrolle:
```bash
crontab -l
```

---

## 6. √úberpr√ºfung in S3
```bash
aws s3 ls s3://backup-raw-bachmann-pe24c/backups/db/school/ --region us-east-1
```
‚Üí Dumps liegen im Bucket, versioniert und mit Lifecycle-Regeln abgesichert.  